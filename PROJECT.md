# Project Overview
- **Project**: GemChant - A game about enhancing jewelry-like gems through different color stages
- **Current Phase**: UI Enhancement - Reduced enhancement video size for better visual balance
- **Tech Stack**: TypeScript, React, Tailwind CSS
- **Environment**: Vite

# File Structure
- src/main.tsx : Entry point for the application, Sets up React rendering and global providers
- src/App.tsx : **UPDATED** - Main game component with alchemist lab background and background music system. Game title "GemChant" and all header text now explicitly use `font-pixel`. Manages game state (money, gems, powder), enhancement/disassembly logic, and powder selection/cancellation. Features alchemist-themed UI with background image overlay and themed styling. Passes `actualPowderBoost` and `displaySuccessRate` to `GemEnhancer`. Handles `handleUsePowder` and `handleCancelPowder`. Added screen shake state management with `isScreenShaking` state and `handleScreenShake` function. Applies `screen-shake-active` class to main container when screen shake is triggered. Added `isAnimationEnabled` state with localStorage persistence for animation toggle preference. Added animation toggle switch in header with ON/OFF states and visual feedback. Passes `isAnimationEnabled` prop to `GemEnhancer` component. Added `isMusicEnabled` state with localStorage persistence for music toggle preference. Added music toggle switch in header with blue-themed styling and ON/OFF states. Integrated `BackgroundMusic` component with music enable/disable functionality and volume control. **UPDATED**: Changed default music state from `true` to `false` so background music starts as OFF by default for better user experience.
- src/components/BackgroundMusic.tsx : Dedicated background music component that handles audio playback with proper state management. Features automatic audio loading with `canplaythrough` event handling, play/pause state tracking, volume control, and graceful error handling for autoplay restrictions. Uses the background music asset from assets.json with loop functionality. Accepts `isEnabled` prop for toggle control and optional `volume` prop for audio level adjustment. Implements proper cleanup of event listeners and hidden audio element rendering.
- src/components/Inventory.tsx : **UPDATED** - Manages the player's inventory slots and stored gems with full alchemist theme integration. Now uses `alchemist-panel` styling for consistent mystical appearance. Title changed to "✦ Mystical Vault ✦" with `alchemist-text-gold` styling and pixel font. Individual slots use `alchemist-inventory-slot` class with proper occupied/empty states and hover effects including scale transformation. Added centered layout for gems and improved empty slot styling with mystical text. Includes helpful instruction text at bottom with alchemist theme styling. Accepts `isAnimating` prop for consistent animation support across all gem displays.
- src/components/GemEnhancer.tsx : **UPDATED** - **MAJOR REDESIGN**: Completely redesigned Arcane Pedestal card with elaborate mystical styling. New features include: mystical header with "✦ ARCANE PEDESTAL ✦" title and subtitle, enhanced chamber with multiple rotating mystical rings (outer, middle, inner), mystical corner runes with pulsing animations, central gem platform with base and glow effects, floating mystical particles around the chamber, and dramatically enhanced result display system. **Enhanced Result Text**: Success/failure messages now use stylish pixel fonts with elaborate styling - success shows "✦ ENHANCEMENT SUCCESSFUL! ✦" with green mystical effects, failure shows "✧ ENHANCEMENT FAILED! ✧" with red mystical effects, disassembly results show "✦ POWDER EXTRACTED! ✦" or "✧ NO POWDER OBTAINED ✧" with appropriate color schemes. All result displays include descriptive subtitles and use pixel fonts with glowing text effects. **Height Consistency**: Card now maintains consistent height with other cards through `min-height` property and proper responsive design. Includes conditional video playback based on `isAnimationEnabled` prop. Added `isAnimationEnabled` prop to control whether enhancement video plays or skips directly to enhancement logic. Modified `handleEnhanceClick` to check animation setting: if enabled, plays video then enhances; if disabled, enhances immediately via `handleDirectEnhancement`. Added `handleDirectEnhancement` function for immediate enhancement without video. Updated video player rendering to only show when animation is enabled. Maintains all existing functionality for powder boosts, visual effects, and screen shake. Calculates `isWaitingForEnhancement` as `canEnhance && !isAnimating && !isVideoPlaying` to show blinking animation when gem is ready for enhancement but not currently being enhanced or playing video. Receives `actualPowderBoost` and `displaySuccessRate` from `App.tsx`. Passes powder controls to `GemPowderInventory`. Includes both burst effect for failures and success effect for successful enhancements with pixel art styling. Passes gem color to both effect components for color-specific visual feedback. Added `onScreenShake` prop and triggers screen shake effect when enhancement fails. Updated "Store in Inventory" section with full alchemist theme styling using `alchemist-panel` and `alchemist-inventory-slot` classes. Added mystical title "✦ Mystical Storage ✦" with gold styling and pixel font. Individual storage slots now use proper alchemist styling with hover effects (scale, border color, shadow). Added descriptive text and instructions with theme-appropriate styling. Improved layout with centered alignment and proper spacing.
- src/components/Gem.tsx : Renders individual gems using pixel art gem assets with enhanced pixel-perfect rendering. Accepts both `isAnimating` and `isWaitingForEnhancement` props. Applies opacity animation (`animate-pulse opacity-70`) during enhancement for ALL gem colors. Applies gentle blinking animation (`gem-waiting-blink`) when gem is waiting to be enhanced (ready but not currently animating). Includes `imageRendering: 'pixelated'` for crisp pixel art display and updated sparkle effects with square shapes for pixel art aesthetic.
- src/components/EnhancementVideoPlayer.tsx : **UPDATED** - Video player component that handles enhancement video playback with fade in/out effects. Manages video state with `isVisible` and `isLoaded` states. Provides smooth fade-in when video starts and fade-out when video ends. Includes loading indicator during video load. Uses fixed positioning to overlay the entire screen with backdrop blur. Automatically plays video when `isPlaying` prop is true and calls `onVideoComplete` callback when video ends. Supports responsive video sizing with object-contain for proper aspect ratio. **UPDATED**: Reduced video container size from `max-w-4xl max-h-4xl` to `max-w-2xl max-h-2xl` for better visual balance and less screen coverage during enhancement animations. **NOTE**: Only renders when animation is enabled in parent component.
- src/components/GemPowderInventory.tsx : Manages local powder staging (+/- buttons), displays boost preview based on `actualPowderBoost` from `App.tsx`. Contains "Apply Powder" and "Cancel Powder" buttons, calling respective handlers in `App.tsx`.
- src/components/GemPowderVault.tsx : Displays the visual inventory of different colored gem powders. Red powder is displayed but is not selectable for applying a boost.
- src/components/BurstEffect.tsx : Creates animated destructive burst effect with fragments and shards when gem enhancement fails. Uses pixel art styling with stepped animations and sharp, blocky particles. Accepts `gemColor` prop and applies color-specific styling to particles. Simplified by removing separate screen shake element as screen shake is now handled at the App level for better effect coverage.
- src/components/SuccessEffect.tsx : Creates animated magical sparkle effect when gem enhancement succeeds. Simplified: Removed pulse rings and glow effect elements. Now focuses only on magical sparkles with stars, diamonds, and glowing particles. Uses pixel art styling with stepped animations and blocky sparkle effects. Accepts `gemColor` prop and applies color-specific styling to sparkles.
- src/utils/gameLogic.ts : Contains game mechanics, enhancement calculations (including powder deduction and color-specific boost rates from `powderBoostRates`), disassembly logic, and progression logic.
- src/types/index.ts : Type definitions for game objects and state. Defines `powderBoostRates` with updated values (Orange: 5%, Yellow: 8%, Green: 10%, Blue: 15%, Indigo: 20%, Red/Purple: 0%).
- src/index.css : Global styles with retro pixel aesthetic, alchemist color scheme (browns, golds, stone grays), blocky borders, stepped animations, and pixelated visual effects. Added `Silkscreen` font import. Added `gemWaitingBlink` keyframe animation and `.gem-waiting-blink` class for gentle blinking effect. Enhanced screen shake animation with `screenShakeIntense` keyframe that includes translation and rotation for more dramatic effect. Added `.screen-shake-active` class for applying screen shake to entire viewport. Includes complete CSS classes for burst and success effects with proper keyframe animations for destructive particles and magical sparkles.
- src/App.css : **UPDATED** - Component-specific styles. Header (`.alchemist-header`, `.alchemist-title`, `.alchemist-subtitle`, `.alchemist-money-display`, `.alchemist-restart-button`) redesigned with a more elaborate mystical alchemist theme, incorporating richer purples, gradient borders, glows, and ensuring all text elements within the header use `font-pixel`. Enhanced pixel art gem styling including `imageRendering: 'pixelated'` classes for crisp pixel art rendering. Maintains alchemist laboratory aesthetic with enhanced text sizing for better readability. Includes pixel-specific sparkle effects with square shapes. Card UI elements (`.alchemist-panel`, `.alchemist-button`, `.alchemist-inventory-slot`, etc.) updated with a mystical color palette (purples, dark blues, silver/gold accents). **Inventory slots now feature enhanced mystical styling with proper occupied/empty states, hover effects, and ethereal inner borders for a more immersive alchemist vault experience.** Added comprehensive Arcane Pedestal styling with `.arcane-pedestal-card` featuring elaborate mystical design with gradient backgrounds, animated borders, and multiple visual layers. Added mystical header styling (`.arcane-pedestal-header`, `.arcane-pedestal-title`, `.arcane-pedestal-subtitle`) with pixel fonts and glowing text effects. Created mystical chamber system (`.arcane-pedestal-chamber`) with rotating rings (`.arcane-ring-outer`, `.arcane-ring-middle`, `.arcane-ring-inner`), pulsing runes (`.arcane-rune`), and central gem platform (`.arcane-gem-platform`) with base and glow effects. Added floating mystical particles (`.arcane-particles`, `.arcane-particle`) with individual animation delays. **Enhanced Result Display**: Created elaborate result display system (`.arcane-result-display`) with different variants for success/failure/disassemble results, featuring pixel fonts, glowing text effects, backdrop blur, and color-specific styling. Added comprehensive animation system with `@keyframes` for glow effects, rotations, pulses, particle floating, and result appearances. Includes full responsive design for mobile devices with adjusted sizes and layouts.
- src/assets.json : Stores URLs and metadata for image, video, and audio assets. Contains high-resolution (1024x1024) pixel art gem images and powder assets with proper metadata. Added `videos` section with `enhancementVideo` asset containing the uploaded enhancement effect video URL and metadata. Added `audio` section with `backgroundMusic` asset containing the mystical background music URL and metadata including loop and volume settings.
- tailwind.config.js : Tailwind CSS configuration. Added `Silkscreen` to font family as `font-pixel`.

# Conversation Context
- **Last Topic**: Reducing the size of the enhancement animation video for better visual balance
- **Key Decisions**:
    - **IMPLEMENTED**: Reduced video container size from `max-w-4xl max-h-4xl` to `max-w-2xl max-h-2xl`
    - **IMPLEMENTED**: Video now takes up less screen space while maintaining aspect ratio and visual quality
    - **IMPLEMENTED**: Better visual balance between video overlay and game interface
    - **IMPLEMENTED**: All existing video functionality preserved (fade effects, loading states, responsive design)
- **User Context**:
  - Technical Level: Intermediate
  - Preferences: Pixel art aesthetic with alchemist/laboratory theme, elaborate visual effects, mystical UI colors, consistent theme across all components, stylish pixel fonts for important text, appropriately sized video overlays that don't dominate the screen.
  - Communication: Direct implementation instructions in Korean and English.

# Implementation Status
## Current State
- **Active Feature**: **COMPLETED** - Enhancement video size reduced for better visual balance.
- **Progress**:
    - **COMPLETED**: Video container size changed from `max-w-4xl max-h-4xl` to `max-w-2xl max-h-2xl`
    - **COMPLETED**: Video now covers less screen area while maintaining proper aspect ratio
    - **COMPLETED**: All existing video functionality preserved (fade in/out, loading indicator, responsive design)
    - **COMPLETED**: Better visual balance between video overlay and game interface
- **Blockers**: None currently.

## Code Evolution
- **Recent Changes**:
    - `src/components/EnhancementVideoPlayer.tsx`: Changed video container classes from `max-w-4xl max-h-4xl` to `max-w-2xl max-h-2xl` for smaller video display
- **Working Patterns**: Successful implementation of video size adjustments while preserving all functionality and visual quality
- **Failed Approaches**: None.

# Requirements
- **Implemented**: Basic game UI, gem enhancement mechanics, inventory system, complete alchemist lab pixel art theme with background, fixed enhancement progression, consistent RNG feedback, high-quality pixel art gem assets with pixel-perfect rendering, gem disassembly system, powder boost mechanics, visual powder inventory, red gem restrictions, powder count display, consistent UI layout, visible money display, improved header with alchemist theme, separate result displays for enhancement and disassembly, fixed powder consumption bug, color-specific powder success rate boosts, Red powder removed from boost selection, updated powder boost rates, added Cancel Powder functionality, complete visual effects system with destructive burst effects for failures and simplified magical sparkle effects for successes, enhanced text readability with larger p tag font sizes, universal opacity animation during enhancement for all gem colors, blinking animation for gems waiting to be enhanced, intense screen shake effect when gem enhancement fails, game title updated to "GemChant" with pixel font, card UI colors updated to a mystical theme, all header text now uses pixel font and header has an enhanced mystical design, video playback feature during gem enhancement with fade in/out effects and proper integration with existing enhancement logic, animation toggle feature allowing players to enable/disable enhancement video playback with localStorage persistence, inventory UI design fully updated to match alchemist theme with mystical vault styling, proper slot states, hover effects, and consistent visual integration, "Store in Inventory" section design updated to match alchemist theme with mystical storage styling, proper slot styling with hover effects, descriptive text, and improved layout, Arcane Pedestal card completely redesigned with elaborate mystical styling including mystical chamber, rotating rings, pulsing runes, floating particles, enhanced result display system with stylish pixel fonts and color-specific mystical effects, height consistency maintained with other cards through responsive design, background music system with mystical atmospheric music, user toggle controls with blue-themed styling, localStorage persistence for music preferences, proper audio state management with loading and error handling, default volume optimization, graceful autoplay restriction handling, default music setting changed to OFF for better user experience, **and enhancement video size reduced from max-4xl to max-2xl for better visual balance and less screen coverage.**
- **In Progress**: None.
- **Pending**: Additional alchemist-themed visual effects and animations for enhanced immersion.
- **Technical Constraints**: Using React and Tailwind CSS with alchemist laboratory pixel art aesthetic. All gem assets are high-resolution pixel art (1024x1024) with pixel-perfect rendering. Image assets are used for gems, powders, and background. Video asset used for enhancement effects when animation is enabled with appropriately sized overlay (max-2xl). Audio asset used for background music with loop functionality and volume control. All UI elements use alchemist color scheme with wood/stone textures and gold accents, now with mystical purple/blue tones for cards and header. Simplified visual effects system with proper CSS animations and pixel art styling. Enhanced text sizing for improved readability while maintaining theme consistency. State-based animation system with waiting and enhancement animations. App-level screen shake system with dramatic visual feedback. Conditional video playback system with fade transitions and loading states based on user preference toggle, now with reduced size for better visual balance. Complete theme consistency across all UI components including inventory and storage interface with mystical vault aesthetic. Arcane Pedestal card features elaborate mystical design with multiple animation layers, rotating elements, floating particles, and enhanced result display system with pixel fonts and color-specific styling. Full responsive design ensures consistent appearance across all device sizes. Background music system with proper audio management, user controls, persistent preferences, and user-friendly default OFF setting.

# Critical Memory
- **Must Preserve**: Gem progression system (Red → Orange → Yellow → Green → Blue → Indigo → Purple), All gems use pixel art assets with pixel-perfect rendering, All gems have consistent opacity animation during enhancement, All gems have blinking animation when waiting to be enhanced, Screen shake effect triggers on enhancement failure, SuccessEffect now shows only magical sparkles without pulse rings or glow effects, Gem powder acquisition chances are higher than enhancement success rates, Powder usage limited to 1 per enhancement, Red gems cannot be disassembled, Red gems cannot have powder applied for a boost. Disassembly success (powder obtained) must be determined by a single random event in `App.tsx`. Powder consumption must correctly deduct from the specific `powderCounts[color]` and update total `gemPowder`. Powder boost rates are color-specific as per `powderBoostRates` in `types.ts`. `actualPowderBoost` in `App.tsx` is the source of truth for the current enhancement boost. Alchemist laboratory pixel art theme with background image and matching color scheme, now incorporating mystical UI card and header colors. Simplified visual effects system with proper CSS classes and animations for both success and failure states. Enhanced text readability with appropriately sized fonts. Game title is "GemChant" and all header text uses `font-pixel`. Animation toggle system: when enabled, enhance button click → video playback → video completion → enhancement logic execution → visual effects based on result; when disabled, enhance button click → immediate enhancement logic execution → visual effects based on result. User preference persisted in localStorage. Inventory UI uses full alchemist theme with mystical vault styling, proper slot states, hover effects, and consistent visual integration. "Store in Inventory" section uses full alchemist theme with mystical storage styling, proper slot styling with hover effects, descriptive text, and improved layout. Arcane Pedestal card features elaborate mystical design with mystical chamber, rotating rings, pulsing runes, floating particles, enhanced result display system with stylish pixel fonts ("✦ ENHANCEMENT SUCCESSFUL! ✦", "✧ ENHANCEMENT FAILED! ✧", "✦ POWDER EXTRACTED! ✦", "✧ NO POWDER OBTAINED ✧") and color-specific mystical effects, height consistency maintained through responsive design. Background music system: BackgroundMusic component handles audio playback with proper state management, music toggle control in header with blue styling and ON/OFF states, localStorage persistence for music preferences, default volume of 0.3, graceful autoplay restriction handling, loop functionality for continuous atmospheric music, and default music state set to `false` for non-intrusive user experience. **Enhancement video system: EnhancementVideoPlayer component with fade in/out effects, loading states, backdrop blur, responsive design, and video container size set to `max-w-2xl max-h-2xl` for appropriate screen coverage and visual balance.**
- **User Requirements**: Success rate halves with each enhancement level, initial Red gem cannot be sold, player starts with $100. Gems should be pixel art style with crisp rendering. All gems should have consistent opacity animation during enhancement process. Gems should blink gently when ready for enhancement but not currently being enhanced or playing video. Screen should shake dramatically when gem enhancement fails. Success effects should show only magical sparkles without additional pulse or glow elements. Gem powder boosts enhancement success rates according to their color. Clear emotional feedback with working visual effects: failure shows destructive burst with screen shake, success shows simplified magical sparkles. All UI elements should have alchemist laboratory aesthetic with pixel art feel and background integration. Text should be easily readable with appropriately sized fonts. Game title should be "GemChant" and all header text should use a pixel font, no emojis. Card UI and Header should have mystical colors. Animation toggle feature allowing players to choose between video-enhanced or immediate enhancement experience with preference persistence. Inventory should have mystical vault theme with proper alchemist styling, hover effects, and consistent visual integration. "Store in Inventory" section should have mystical storage theme with proper alchemist styling, hover effects, descriptive text, and consistent visual integration. Arcane Pedestal card should be more elaborate and match the game's mystical atmosphere with height consistency to other cards. Success/failure text should use stylish pixel fonts with elaborate visual effects. Background music should provide atmospheric enhancement to the alchemist laboratory experience with user control over music playback, persistent preference settings, and default to OFF so users can choose to enable it rather than being surprised by automatic audio playback. **Enhancement video should be appropriately sized to provide visual enhancement without dominating the screen or interfering with game interface visibility.**
- **Known Issues**: None currently.

# Next Actions
- **Immediate**: Await further user requests.
- **Open Questions**: None.
